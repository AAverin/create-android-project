# Create Android Project

## Engine

Engine is a series of git patches applied one after the other according to selected features.

Resulting is the Android project with precofigured features and libraries.

### How it works:

Having the following tree structure:

```
/0-base
  /0-defaults
    commit.msg
    patch.diff
  /1-version-catalogs
    commit.msg
    stage.diff
    patch.diff
/1-ci
  /github-actions
    rule.js
    /0-defaults
      commit.msg
      stage.diff
      patch.diff
    /1-ktlint
      commit.msg
      stage.diff
      patch.diff
  /travis
    rule.js
    /0-defaults
      commit.msg
      stage.diff
      patch.diff
/2-common
  /1-ktlint
    /0-defaults
      commit.msg
      stage.diff
      patch.diff
/3-deps
  /1-library
    /0-defaults
      commit.msg
      stage.diff
      patch.diff
```

and having a run configuration provided to the CLI

CLI walks through the folders, applies `rule.js` file to decide if some folder should be processed and then generates a set of commands to run. For example:

```
[
  'git init',
  'git apply /Volumes/Data/Projects/github.com/AAverin/create-android-project/engine/library/0-base/0-defaults/patch.diff',
  'git commit -m "Create-Android-Project Library: Initial setup"',
  'git apply /Volumes/Data/Projects/github.com/AAverin/create-android-project/engine/library/0-base/1-version-catalogs/staged.diff',
  'git apply /Volumes/Data/Projects/github.com/AAverin/create-android-project/engine/library/0-base/1-version-catalogs/patch.diff',
  'git commit -m "Create-Android-Project Library: Support Version Catalogs"',
  'git apply /Volumes/Data/Projects/github.com/AAverin/create-android-project/engine/library/0-base/2-sample-app/patch.diff',
  'git commit -m "Create-Android-Project Library: Sample app"'
]
```

Commands are executed in the local `generated` folder one by one, resulting in a list of applied patches and commits.

The outcome is an Android or Android Library project set up according to selected configuration.


The engine is a CLI that accepts different parameters:

```
> node engine.js --help                           
Options:
      --version  Show version number                                   [boolean]
  -t, --type     Type of project to generate.
                            [choices: "project", "library"] [default: "project"]
      --ci       Kind of CI integration
                                   [array] [choices: "github", ""] [default: ""]
  -c, --common   Common integrations                 [array] [choices: "ktlint"]
  -v, --verbose  logging                                               [boolean]
      --help     Show help                                             [boolean]
```

Parameters are then wrapped into a Config object with helper methods.

Inside `engine` there is an hierarchy of folders.
Every folder can have `rule.js` files, if function `shouldRun` inside it returns false folder is ignored.
If the folder has file `commit.msg` then folder is processed for patches. Following files are supported:
- `commit.msg` with a single string from commit message
- `staged.diff` a patch file of all staged files, generated by running `git diff --staged >> staged.diff`. Used to ensure that all folders are correctly created
- `patch.diff` a patch file of all changes, generated by running `git diff >> patch.diff`
- `do.sh` an optional bash script that will be run in the end

Depending on configuration, for every folder in `library` ordered, for every child folder ordered:
  - `patch.diff` file is applied using `git apply patch.diff`
  - results are commited using `commit.msg` as text
  - Optional: `do.sh` is executed

# Contributing

Do you want your library to be added to the configuration?

Here are a few steps to take:

1. Prepare an isolated git patch that integrates your library
  - include your library into gradle dependencies
  - include R8/proguard rules update 
2. Put your patch into a correct folder so that engine could apply your patch correctly.
3. Make a PR with:
  - description of your library
  - new rules added to the CLI
  - new rules added to the Config
  - rule.js file
